# キャラクター設定 ユーザー設定ファイル一覧

**作成日**: 2026年1月18日
**対象**: duo-talk-simple プロジェクト

---

## 概要

このドキュメントでは、キャラクター（やな・あゆ）の性格や振る舞いをカスタマイズするために編集可能なファイルを一覧にまとめています。

---

## 1. ペルソナ定義ファイル（必須）

キャラクターの根本的な性格を定義する最重要ファイルです。

| ファイル | 用途 | 編集優先度 |
|---------|------|-----------|
| `personas/yana.yaml` | やな（姉）の性格定義 | **高** |
| `personas/ayu.yaml` | あゆ（妹）の性格定義 | **高** |

### 1.1 ペルソナYAMLの構造

```yaml
# 基本情報
id: yana                    # 内部識別子
role: sister_older          # 役割
callname_self: "やな"       # 自分の呼び方
callname_other: "あゆ"      # 相手の呼び方

# 表面的なスタイル
style:
  register: casual          # 口調（casual / formal）
  tempo: fast               # 話すテンポ（fast / normal / slow）
  length: short             # 発言の長さ（short / medium / long）
  quirks:                   # 特徴・癖
    - "軽口はOKだが侮辱はNG"
    - "動かしてみる/試すを優先"
  forbidden:                # 禁止事項
    - "人格否定"
    - "長すぎる説教"

# 深層の価値観（最重要）
deep_values:
  core_belief: "動かしてみなきゃわからない"  # 信念
  decision_priority:        # 判断基準の重み（0-100）
    intuition: 70           # 直感
    speed: 65               # スピード
    accuracy: 45            # 正確さ
    safety: 50              # 安全性
    empathy: 55             # 共感
  collaboration:            # 協力関係
    strengths: ["探索", "試行", "突破口"]
    asks_from_other: ["検証", "安全確認", "数値の裏付け"]

# 必須の感情状態
required_states:
  - excited      # 興奮
  - confident    # 自信
  - worried      # 心配
  - impatient    # 焦り
  - focused      # 集中
  - curious      # 好奇心

# 状態別の生成パラメータ
state_controls:
  excited:
    temperature: 0.9        # 生成のランダム性（高い=多様）
    max_sentences: 3        # 最大文数
    tone_notes:             # トーンのヒント
      - "勢いを持たせる"
      - "まず試すと宣言"
  # ... 他の状態も同様
```

### 1.2 カスタマイズのポイント

| 項目 | 効果 | 例 |
|-----|------|-----|
| `core_belief` | キャラの根本的な考え方を決定 | "データが全て" → 慎重な性格に |
| `decision_priority` | 判断時の優先順位を決定 | safety: 90 → 安全重視 |
| `temperature` | 発言の多様性を調整 | 0.9 = 創造的, 0.3 = 一貫性重視 |
| `tone_notes` | LLMへの具体的な指示 | "敬語で話す", "疑問形を多用" |

---

## 2. Few-shotパターンファイル

発話スタイルの具体例を提供するファイルです。

| ファイル | 用途 | 編集優先度 |
|---------|------|-----------|
| `patterns/few_shot_patterns.yaml` | 発話の例文集 | **中** |

### 2.1 Few-shotパターンの構造

```yaml
items:
  - id: yana_excited_01           # パターンID
    persona: yana                 # 対象キャラ
    state: excited                # 感情状態
    trigger: "新しいアイデアや実験チャンスが来たとき"  # 発火条件
    examples:                     # 例文（複数可）
      - "おー、面白そう。まず動かしてみよ。失敗したらその場で直せばいい。"

  - id: ayu_concerned_01
    persona: ayu
    state: concerned
    trigger: "危険/破綻リスクが高いとき"
    examples:
      - "姉様、それは危険です。先に安全策を一つ入れて、必要なら代替案Bも並走させましょう。"
```

### 2.2 現在のパターン一覧

| キャラ | 状態 | パターンID |
|-------|------|-----------|
| やな | excited | `yana_excited_01` |
| やな | confident | `yana_confident_01` |
| やな | worried | `yana_worried_01` |
| やな | impatient | `yana_impatient_01` |
| やな | focused | `yana_focused_01` |
| やな | curious | `yana_curious_01` |
| あゆ | analytical | `ayu_analytical_01` |
| あゆ | supportive | `ayu_supportive_01` |
| あゆ | concerned | `ayu_concerned_01` |
| あゆ | proud | `ayu_proud_01` |
| あゆ | focused | `ayu_focused_01` |

### 2.3 パターン追加時の注意

- `personas/*.yaml` の `required_states` に定義された状態に対応するパターンが必要
- 例文は **短く（1-2文）**、**Deep Valuesと矛盾しない** 内容にする
- 同じ状態に複数パターンを追加可能（ランダム選択される）

---

## 3. RAG知識ベースファイル

会話で参照される知識を格納するファイルです。

| ファイル | 用途 | 形式 | 編集優先度 |
|---------|------|------|-----------|
| `knowledge/sisters_shared.txt` | 姉妹の共有設定・物語 | テキスト | **高** |
| `knowledge/jetracer_tech.txt` | 技術知識（視点なし） | テキスト | 中 |
| `knowledge/jetracer_tech_with_perspectives.txt` | 技術知識（視点付き） | テキスト | **高** |

### 3.1 通常形式（視点なし）

```text
# JetRacerの基本情報

JetRacerはNVIDIA Jetson Nanoを搭載した自動運転RCカーです。
カメラとセンサーを使用して障害物を検知し、自律走行を行います。

## センサー構成
- 前方カメラ: 1280x720
- 超音波センサー: 3個（前方、左右）
- IMU: 9軸
```

### 3.2 視点付き形式（推奨）

視点付き形式を使用すると、キャラクターごとに異なる解釈で知識を参照できます。

```text
## センサ統合（IMU + カメラ + オプティカルフロー）

【客観】
- IMU: 姿勢/角速度、オプフロ: 相対移動、カメラ: 環境認識
- 同期ズレは推定誤差に直結。タイムスタンプの基準を統一する

【やなの視点】
- まず動く最小構成で走らせてズレを可視化。ログを残して後から詰める

【あゆの視点】
- 同期が崩れると学習も推論も破綻。先に遅延計測と校正プロセスを決める
```

### 3.3 知識ファイル追加方法

1. `knowledge/` ディレクトリにテキストファイルを作成
2. `config.yaml` の `knowledge.sources` に登録

```yaml
knowledge:
  sources:
    - file: "new_knowledge.txt"
      metadata:
        domain: "technical"      # ドメイン分類
        character: "both"        # 参照可能キャラ（yana/ayu/both）
        priority: "medium"       # 優先度（high/medium/low）
```

---

## 4. Director介入ルール（将来用）

会話の脱線や衝突時の介入条件を定義するファイルです。

| ファイル | 用途 | 編集優先度 |
|---------|------|-----------|
| `director/director_rules.yaml` | 会話介入条件 | 低（未実装） |

### 4.1 Director介入ルールの構造

```yaml
intervention_policy:
  default: "silent"           # 通常は介入しない
  max_tokens: 120             # 介入時の最大トークン
  style: "short, one-goal"    # 短く、一つの目標だけ伝える

triggers:
  - id: derailment            # 脱線検知
    when:
      any:
        - "topic_drift_score >= 0.7"
        - "user_says in ['戻って', 'まとめて']"
    action: "summarize_and_refocus"

  - id: safety                # 安全リスク検知
    when:
      any:
        - "policy_risk == true"
    action: "refuse_or_redirect"

actions:
  summarize_and_refocus:
    template: "ここまでを20語以内で要約し、次に決める1点を提示する。"
  refuse_or_redirect:
    template: "ポリシー違反を明示し、安全な代替案を1つだけ示す。"
```

---

## 5. システム設定ファイル

全体の動作パラメータを設定するファイルです。

| ファイル | 用途 | 編集優先度 |
|---------|------|-----------|
| `config.yaml` | 全体設定 | 中 |

### 5.1 キャラクター関連の設定項目

```yaml
# キャラクター設定
characters:
  yana:
    enabled: true
    config: "./personas/yana.yaml"
    generation:
      temperature: 0.8        # 生成時のデフォルト温度
      max_tokens: 2000        # 最大トークン数
      top_p: 0.9
      frequency_penalty: 0.3
    max_history: 10           # 保持する会話履歴数
    use_rag_by_default: true  # RAGを使用するか

  ayu:
    enabled: true
    config: "./personas/ayu.yaml"
    generation:
      temperature: 0.7
      max_tokens: 2000
    # ...

# プロンプトアセットへのパス
prompt_assets:
  few_shot_patterns: "./patterns/few_shot_patterns.yaml"
  director_rules: "./director/director_rules.yaml"

# AI姉妹対話モード設定
duo_dialogue:
  max_turns: 10               # 最大往復数
  first_speaker: "yana"       # 最初に発言するキャラ
  show_turn_count: true       # ターン数を表示
  typing_delay: 0.5           # 発言間の遅延（秒）
  convergence_keywords:       # 収束を示すキーワード
    - "結論として"
    - "まとめると"
    - "決まりだね"
    - "そうしましょう"

# 会話ログ設定
conversation_log:
  enabled: true               # 会話ログを有効化
  log_dir: "./logs/conversations"  # ログ保存ディレクトリ
```

---

## 6. ファイル編集の優先度まとめ

| 優先度 | ファイル | 効果 | 推奨用途 |
|-------|---------|------|---------|
| **高** | `personas/*.yaml` | キャラクターの根本的な性格を決定 | 新キャラ作成、性格変更 |
| **高** | `knowledge/*.txt` | 会話で参照される知識を決定 | 専門知識の追加 |
| **中** | `patterns/*.yaml` | 発話スタイルの具体例を提供 | 口調の微調整 |
| **中** | `config.yaml` | 生成パラメータの微調整 | 温度調整、履歴数変更 |
| **低** | `director_rules.yaml` | 介入条件（未実装） | 将来の拡張用 |

---

## 7. カスタマイズ例

### 7.1 新しいキャラクターを追加する場合

1. `personas/new_char.yaml` を作成（既存ファイルをコピーして編集）
2. `patterns/few_shot_patterns.yaml` に対応パターンを追加
3. `config.yaml` の `characters` セクションに登録

### 7.2 キャラクターをより慎重にする場合

```yaml
# personas/yana.yaml
deep_values:
  decision_priority:
    safety: 80      # 50 → 80 に上げる
    speed: 40       # 65 → 40 に下げる

state_controls:
  excited:
    temperature: 0.6  # 0.9 → 0.6 に下げる（より一貫性重視）
```

### 7.3 専門知識を追加する場合

1. `knowledge/new_topic.txt` を作成
2. 視点付き形式で記述（【客観】【やなの視点】【あゆの視点】）
3. `config.yaml` に登録

---

## 8. 注意事項

1. **YAML構文**: インデントはスペース2個。タブは使用不可
2. **文字コード**: UTF-8で保存
3. **整合性**: `required_states` と Few-shot パターンの対応を維持
4. **テスト**: 変更後は `pytest tests/test_prompt_builder.py` で検証

---

**ドキュメント作成日**: 2026年1月18日
**duo-talk-simple プロジェクト**
